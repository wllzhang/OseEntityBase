# 数字地图脚手架库 (Digital Map Scaffold Library)

## 项目概述

目标是成为一个脚手架的数字地图库, 对GeoEntity进行封装, 对其状态进行管理, 可对其进行渲染, 同时将其数字地图上的任务GeoEntity和数字地图的状态信息抽象为一个信息层, 传递给其他服务.

## 技术栈

- **Qt 5/6**: GUI框架
- **OSG (OpenSceneGraph)**: 3D图形渲染引擎
- **osgEarth**: 基于OSG的地球渲染库
- **C++11**: 编程语言标准

## 项目结构

```
项目根目录/
├── geo/                           # 地理实体模块
│   ├── geoentity.h/cpp           # 通用地理实体基类
│   ├── imageentity.h/cpp         # 图片实体实现
│   └── geoentitymanager.h/cpp    # 通用实体管理器
├── OsgQt/                        # OSG-Qt集成组件
├── images/                       # 实体图片资源
├── earth/                        # 地球配置文件
├── main.cpp                      # 程序入口
├── mainwindow.h/cpp             # 主窗口
├── imageviewerwindow.h/cpp       # 图片查看器
├── draggablelistwidget.h/cpp     # 可拖拽列表
├── images_config.json           # 实体配置文件
└── osgEarth.pro                 # 项目文件
```

## 已完成功能 (DONE)

### ✅ 核心架构
- [x] 通用GeoEntity基类设计 - 支持自我管理的地理实体
- [x] ImageEntity具体实现 - 基于图片的实体渲染
- [x] GeoEntityManager管理器 - 统一的实体管理接口
- [x] 模块化代码组织 - geo模块独立管理

### ✅ 3D地图功能
- [x] 3D地球显示 - 基于osgEarth的球面渲染
- [x] 高德地图瓦片集成 - 在线地图服务支持
- [x] 地球漫游控制 - 缩放、旋转、平移操作
- [x] 相机视角管理 - 自动定位到实体位置

### ✅ 实体管理
- [x] 拖拽添加实体 - 从列表拖拽到地图
- [x] 实体位置管理 - 经纬度坐标定位
- [x] 实体朝向控制 - 旋转角度设置
- [x] 实体大小控制 - 可配置的渲染尺寸
- [x] 实体状态管理 - 可见性、选中状态
- [x] 实体属性系统 - 动态属性设置和获取

### ✅ 用户界面
- [x] 主窗口集成 - Qt与OSG的无缝集成
- [x] 图片查看器 - 实体列表和预览
- [x] 可拖拽列表 - 支持拖拽操作的控件
- [x] 控制面板 - 3D模式切换、实体管理

### ✅ 配置系统
- [x] JSON配置文件 - 实体信息和属性配置
- [x] 动态配置加载 - 运行时配置更新
- [x] 实体类型扩展 - 支持多种实体类型

## 待完成任务 (TODO)

1. **地图状态信息获取**
   - 完成地图window的获取,获取当前鼠标信息的以下信息:
   - Pitch (俯仰角) a
   - Heading (航向角) b 
   - Range (距离): c
   - 获取视角当前经纬高  x1,y1,z1 
   - 获取鼠标当前经纬高  x2,y2,z2
   - 组成元组信息 (a,b,c,x1,y1,z1,x2,y2,z2)

2. **高度管理**
   - 完成高度设置功能
   - 高度动态调整
   - 高度约束和验证

3. **交互功能**
   - 完成GeoEntity的点击设置
   - 实体选择和高亮
   - 右键菜单功能

4. **信息层抽象**
   - 地图状态信息抽象
   - 实体状态信息抽象
   - 服务接口设计

## 更新日志

### v1.0.0 (2024-10-23)
**重大重构版本 - 通用化架构**

#### 🎯 核心重构
- **重构AircraftManager为GeoEntityManager** - 从特定飞机管理升级为通用地理实体管理
- **创建通用GeoEntity基类** - 支持自我管理的地理实体基类
- **实现ImageEntity具体类** - 基于图片的实体渲染实现
- **模块化代码组织** - 将geo相关代码移动到geo文件夹

#### 🔧 技术改进
- **自我管理设计** - 每个实体管理自己的状态、位置、朝向和属性
- **配置驱动** - 通过JSON配置文件定义实体类型和属性
- **可扩展架构** - 支持轻松添加新的实体类型
- **统一接口** - 所有实体类型使用相同的管理接口
 

#### 🎨 功能特性
- **实体大小控制** - 支持动态调整实体渲染大小
- **拖拽功能** - 从实体列表拖拽到地图添加实体
- **旋转控制** - 支持设置实体朝向角度
- **状态管理** - 实体的可见性、选中状态管理
- **属性系统** - 动态属性设置和获取

### v0.1.0 (初始版本)
- **基础3D地图显示** - 基于osgEarth的3D地球渲染
- **战斗机管理** - 基本的飞机实体添加和管理
- **Qt-OSG集成** - 图形界面与3D渲染的集成
- **拖拽功能** - 基本的拖拽添加实体功能